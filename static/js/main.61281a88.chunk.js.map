{"version":3,"sources":["components/TopPanel/Button.jsx","components/TopPanel/TopPanel.jsx","components/BottomPanel/SizeBlock.jsx","components/BottomPanel/ColorCircle.jsx","components/BottomPanel/ColorBlock.jsx","components/BottomPanel/ToggleIcon.jsx","components/BottomPanel/ModeArea.jsx","components/BottomPanel/BottomPanel.jsx","components/Canvas.jsx","App.jsx","index.js"],"names":["Wrapper","styled","div","_templateObject","Container","_templateObject2","_ref","disabled","css2","_templateObject3","React","memo","_ref2","_ref2$Icon","Icon","_ref2$text","text","_ref2$onClick","onClick","f","_ref2$disabled","react_default","a","createElement","size","className","TopPanel_templateObject","props","open","CollapseButton","TopPanel_templateObject2","TopPannel","_ref$onClickClearBtn","onClickClearBtn","onClickRedoBtn","onClickUndoBtn","onClickSaveBtn","_ref$canRedo","canRedo","_ref$canUndo","canUndo","_useState","useState","_useState2","Object","slicedToArray","setOpen","TopPanel_Wrapper","TopPanel_Button","MdSave","MdFullscreen","MdUndo","MdRedo","md","SizeBlock_templateObject","setSize","onCheckSize","inputRef","useRef","useEffect","input","current","selectionStart","selectionEnd","value","length","SizeBlock_Wrapper","type","ref","onChange","e","target","onBlur","onKeyPress","key","onKeyDown","isNaN","keyCode","Number","Circle","ColorCircle_templateObject","color","ColorCircle","_ref3","_ref3$select","select","_ref3$color","_ref3$onClick","ColorBlock_templateObject","ColorBlock","selectColor","setSelectColor","setColor","ColorBlock_Wrapper","map","idx","BottomPanel_ColorCircle","ToggleIcon_templateObject","ToggleIcon","_ref$onClick","_ref$open","ToggleIcon_Wrapper","ModeArea_templateObject","ModeArea","mode","setMode","ModeArea_Wrapper","MdBrush","modeName","FaEraser","MdBorderClear","concat","BottomPanel_templateObject","BottomPanel","Fragment","BottomPanel_Wrapper","BottomPanel_SizeBlock","BottomPanel_ColorBlock","backgroundColor","Canvas","canvas","Canvas_templateObject","Window","Canvas_templateObject2","makePicture","dataImg","Promise","resolve","reject","canvasPic","Image","src","onload","onerror","renderLoop","ctx","canUpdate","mouseX","mouseY","updateKey","resizeCanvas","_canvas$getBoundingCl","getBoundingClientRect","width","height","drawCursor","beginPath","strokeStyle","lineWidth","lineJoin","lineCap","moveTo","lineTo","stroke","arc","Math","PI","fillStyle","fill","closePath","update","cancelAnimationFrame","requestAnimationFrame","drawImage","fillRect","init","newCanvas","getContext","setCursor","x","y","setSpec","spec","setDataImg","newDataImg","getDataImg","stopUpdate","startUpdate","clearCanvas","checkSize","oldSize","newSize","tmpSize","parseInt","updateMovingWindow","memoryCanvas","document","copyCanvas","memoryCtx","copyCtx","isMakingNewSecence","buffer","_checkBuffer","tmp","_update","apply","toConsumableArray","_x","_update2","this","arguments","asyncToGenerator","regenerator_default","mark","_callee","_ref4","oldWin","newWin","dataPic","copyImgData","copyPic","wrap","_context","prev","next","abrupt","sent","getImageData","w","h","putImageData","toDataURL","clearRect","stop","_len","args","Array","_key","console","log","oriX","oriY","components_Canvas","canvasRef","downloadTagRef","drawing","setDrawing","_useState3","_useState4","_useState5","_useState6","_useState7","_useState8","history","setHistory","_useState9","_useState10","historyIdx","setHistoryIdx","_useState11","_useState12","_useState13","_useState14","setOldWin","_useState15","_useState16","win","setWin","_useState17","_useState18","showWin","setShowWin","_useState19","_useState20","isCreateWindow","setIsCreateWindow","_useState21","_useState22","isAdjusteWindow","setIsAdjusteWindow","canvasStyle","cursor","windowStyle","left","top","display","pushHistory","oldHistory","slice","onWindowMouseMove","min","clientX","clientY","abs","onWindowMouseUp","window","addEventListener","removeEventListener","objectSpread","style","onMouseDown","correctSize","newColor","_ref$color","_ref$size","drawLineStart","onMouseMove","drawLine","onMouseUp","onMouseLeave","TopPanel","dataURL","aTag","href","download","Date","toISOString","click","BottomPanel_BottomPanel","hidden","GlobalStyle","createGlobalStyle","App_templateObject","App","ReactDOM","render","src_App","getElementById"],"mappings":"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","file":"static/js/main.61281a88.chunk.js","sourcesContent":["import React from 'react';\nimport styled, { css as css2 } from 'styled-components';\n\nconst Wrapper = styled.div`\n  display: inline-block;\n  /* background: pink; */\n  padding: 14px 0;\n  margin: 0 14px;\n`;\n\nconst Container = styled.div`\n  /* background: skyblue; */\n  padding: 2px 0;\n  padding-right: 8px;\n  padding-left: 2px;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: background 300ms;\n  &:hover {\n    background: #e8e8e8;\n  }\n\n  > * {\n    vertical-align: middle;\n  }\n  .btn-text {\n    margin-left: 4px;\n  }\n\n  ${({ disabled }) =>\n    disabled &&\n    css2`\n    color: grey;\n    pointer-events: none;\n  `};\n`;\n\nfunction Button({\n  Icon = () => null,\n  text = '',\n  onClick = f => f,\n  disabled = false\n}) {\n  return (\n    <Wrapper>\n      <Container onClick={onClick} disabled={disabled}>\n        <Icon size={48} />\n        <span className=\"btn-text\">{text}</span>\n      </Container>\n    </Wrapper>\n  );\n}\n\nexport default React.memo(Button);\n","import React, { useState } from 'react';\nimport styled from 'styled-components';\nimport {\n  MdSave,\n  MdFullscreen,\n  MdRedo,\n  MdUndo,\n  MdKeyboardArrowUp\n} from 'react-icons/md';\nimport Button from './Button';\n\nconst Wrapper = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  background: white;\n  text-align: center;\n  transform: translateY(${props => (props.open ? '0' : '-100%')});\n  transition: 600ms;\n\n  > * {\n    vertical-align: middle;\n  }\n`;\n\nconst CollapseButton = styled.div`\n  width: 56px;\n  height: 56px;\n  position: absolute;\n  z-index: -1;\n  left: 50%;\n  margin-left: -28px;\n  bottom: -28px;\n  background: white;\n  border-radius: 100%;\n  text-align: center;\n  line-height: 56px;\n  cursor: pointer;\n\n  > * {\n    margin-bottom: -20px;\n    transform: rotate(${props => (props.open ? '0' : '-180')}deg);\n    transition: transform 600ms;\n  }\n`;\n\nfunction TopPannel({\n  onClickClearBtn = f => f,\n  onClickRedoBtn,\n  onClickUndoBtn,\n  onClickSaveBtn,\n  canRedo = false,\n  canUndo = false\n}) {\n  const [open, setOpen] = useState(true);\n  const togglePanel = () => setOpen(!open);\n\n  return (\n    <Wrapper open={open}>\n      <Button Icon={MdSave} text=\"SAVE\" onClick={onClickSaveBtn} />\n      <Button Icon={MdFullscreen} text=\"CLEAR ALL\" onClick={onClickClearBtn} />\n      <Button\n        Icon={MdUndo}\n        text=\"UNDO\"\n        onClick={onClickUndoBtn}\n        disabled={!canUndo}\n      />\n      <Button\n        Icon={MdRedo}\n        text=\"REDO\"\n        onClick={onClickRedoBtn}\n        disabled={!canRedo}\n      />\n      <CollapseButton open={open} onClick={togglePanel}>\n        <MdKeyboardArrowUp size={24} />\n      </CollapseButton>\n    </Wrapper>\n  );\n}\n\nexport default TopPannel;\n","import React, { useRef, useEffect } from 'react';\nimport styled from 'styled-components';\n\nconst Wrapper = styled.div`\n  /* background: pink; */\n  display: inline-flex;\n  align-items: center;\n\n  input {\n    margin: 0 8px 0 16px;\n    border: none;\n    outline: none;\n    height: 100%;\n    text-align: center;\n    font-size: 20px;\n    width: 74px;\n    background: #e8e8e8;\n    border-radius: 24px;\n  }\n\n  span {\n    font-size: 20px;\n  }\n`;\n\nfunction SizeBlock({ size, setSize, onCheckSize }) {\n  const inputRef = useRef(null);\n\n  function onKeyPress(e) {\n    if (e.key === 'Enter') {\n      onCheckSize();\n    }\n  }\n\n  function onKeyDown(e) {\n    if (isNaN(size)) {\n      return;\n    }\n\n    if (e.keyCode === 38) {\n      return setSize(Number(size) + 1);\n    }\n\n    if (e.keyCode === 40) {\n      return setSize(Number(size) - 1);\n    }\n  }\n\n  useEffect(() => {\n    const input = inputRef.current;\n    input.selectionStart = input.selectionEnd = input.value.length;\n  });\n\n  return (\n    <Wrapper>\n      <span>SIZE:</span>\n      <input\n        type=\"text\"\n        ref={inputRef}\n        value={size}\n        onChange={e => setSize(e.target.value)}\n        onBlur={onCheckSize}\n        onKeyPress={onKeyPress}\n        onKeyDown={onKeyDown}\n      />\n      <span>px</span>\n    </Wrapper>\n  );\n}\n\nexport default React.memo(SizeBlock);\n","import React from 'react';\nimport styled from 'styled-components';\nimport { MdDone } from 'react-icons/md';\n\nconst Circle = styled.div`\n  width: 48px;\n  height: 48px;\n  border: solid 2px;\n  background: ${props => props.color};\n  border-color: ${({ color }) => {\n    if (color === '#fff' || color === '#ffffff' || color === 'white')\n      return '#000';\n    return color;\n  }};\n  border-radius: 50%;\n  margin-right: 8px;\n  &:last-child {\n    margin-right: 0;\n  }\n  text-align: center;\n  line-height: 48px;\n  color: ${({ color }) => {\n    if (color === '#000' || color === '#000000' || color === 'black') {\n      return '#fff';\n    }\n    return '#000';\n  }};\n  cursor: pointer;\n`;\n\nfunction ColorCircle({ select = false, color = '#fff', onClick = f => f }) {\n  return (\n    <Circle color={color} onClick={onClick}>\n      {select && <MdDone />}\n    </Circle>\n  );\n}\n\nexport default ColorCircle;\n","import React from 'react';\nimport styled from 'styled-components';\nimport ColorCircle from './ColorCircle.jsx';\n\nconst Wrapper = styled.div`\n  /* background: pink; */\n  display: inline-flex;\n  align-items: center;\n  font-size: 20px;\n  span {\n    margin-right: 16px;\n  }\n`;\n\nfunction ColorBlock({ color: selectColor, setColor: setSelectColor }) {\n  return (\n    <Wrapper>\n      <span>COLOR:</span>\n      {['#ffffff', '#000000', '#9BFFCD', '#00CC99', '#01936F'].map(\n        (color, idx) => (\n          <ColorCircle\n            select={color === selectColor}\n            color={color}\n            key={idx}\n            onClick={() => setSelectColor(color)}\n          />\n        )\n      )}\n    </Wrapper>\n  );\n}\n\nexport default ColorBlock;\n","import React from 'react';\nimport styled from 'styled-components';\nimport { MdKeyboardArrowDown, MdBrush } from 'react-icons/md';\n\nconst Wrapper = styled.div`\n  position: fixed;\n  z-index: 0;\n  width: 56px;\n  height: 56px;\n  left: 50%;\n  margin-left: -28px;\n\n  bottom: ${props => (props.open ? '120px' : '68px')};\n  @media (max-width: 888px) {\n    bottom: ${props => (props.open ? '241px' : '68px')};\n  }\n\n  margin-bottom: -28px;\n  background: white;\n  border-radius: 100%;\n  text-align: center;\n  line-height: 56px;\n  cursor: pointer;\n  transition: all 600ms;\n  box-shadow: 0px 4px 16px rgba(0, 0, 0, 0.16);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  > * {\n    transition: all 600ms;\n    line-height: 56px;\n  }\n\n  .arrow-down-icon {\n    position: relative;\n    top: ${props => (props.open ? '-10px' : '0px')};\n    opacity: ${props => (props.open ? '1' : '0')};\n  }\n\n  .brush-icon {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    opacity: ${props => (props.open ? '0' : '1')};\n  }\n`;\n\nexport default ({ onClick = f => f, open = true }) => (\n  <Wrapper onClick={onClick} open={open}>\n    <MdKeyboardArrowDown size={24} className=\"arrow-down-icon\" />\n    <MdBrush size={24} className=\"brush-icon\" />\n  </Wrapper>\n);\n","import React from 'react';\nimport styled from 'styled-components';\nimport { MdBrush, MdBorderClear } from 'react-icons/md';\nimport { FaEraser } from 'react-icons/fa';\n\nconst Wrapper = styled.div`\n  display: inline-flex;\n  /* background: grey; */\n  height: auto !important;\n  white-space: nowrap;\n\n  > * {\n    margin-left: 10px;\n    padding: 2px;\n    border-radius: 10px;\n    &:first-child {\n      margin-left: 0;\n    }\n\n    &:hover {\n      background: #e8e8e8;\n    }\n\n    /* background: ${props => (props.select ? 'grey' : 'pink')}; */\n    cursor: pointer;\n    &.select {\n      background: lightgray;\n    }\n  }\n`;\n\nexport default ({ mode, setMode }) => {\n  return (\n    <Wrapper>\n      {[\n        { Icon: MdBrush, modeName: 'mode_draw' },\n        { Icon: FaEraser, modeName: 'mode_eraser' },\n        { Icon: MdBorderClear, modeName: 'mode_window' }\n      ].map(({ Icon, modeName }) => (\n        <Icon\n          key={modeName}\n          size={52}\n          className={`${modeName === mode ? 'select' : ''}`}\n          onClick={() => setMode(modeName)}\n        />\n      ))}\n    </Wrapper>\n  );\n};\n","import React, { useState } from 'react';\nimport styled from 'styled-components';\nimport SizeBlock from './SizeBlock.jsx';\nimport ColorBlock from './ColorBlock.jsx';\nimport ToggleIcon from './ToggleIcon';\nimport ModeArea from './ModeArea';\n\nconst Wrapper = styled.div`\n  position: fixed;\n  z-index: 1;\n  bottom: 40px;\n  left: 50%;\n  transform: ${props =>\n    props.open ? 'translate(-50%, 0)' : 'translate(-50%, calc(100% + 40px))'};\n  transition: transform 600ms;\n  background: white;\n  box-shadow: 0px 4px 16px rgba(0, 0, 0, 0.16);\n  border-radius: 50px;\n  padding: 16px 40px;\n  white-space: nowrap;\n\n  > * {\n    height: 48px;\n    vertical-align: middle;\n    &:nth-child(n + 2) {\n      margin-left: 40px;\n    }\n  }\n\n  @media (max-width: 888px) {\n    white-space: pre-wrap;\n    padding: 16px 24px;\n\n    > * {\n      display: flex;\n\n      &:nth-child(n + 2) {\n        margin-left: 0px;\n        margin-top: 10px;\n      }\n    }\n  }\n`;\n\nfunction BottomPanel({\n  size,\n  setSize,\n  onCheckSize,\n  color,\n  setColor,\n  mode,\n  setMode\n}) {\n  const [open, setOpen] = useState(true);\n  const onTogglePanel = () => setOpen(!open);\n\n  return (\n    <>\n      <Wrapper open={open}>\n        <ModeArea mode={mode} setMode={setMode} />\n        <SizeBlock size={size} onCheckSize={onCheckSize} setSize={setSize} />\n        <ColorBlock color={color} setColor={setColor} />\n      </Wrapper>\n      <ToggleIcon open={open} onClick={onTogglePanel} />\n    </>\n  );\n}\n\nexport default BottomPanel;\n","import React, { useRef, useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport TopPanel from './TopPanel/TopPanel.jsx';\nimport BottomPanel from './BottomPanel/BottomPanel.jsx';\n\nconst backgroundColor = '#e8e8e8';\n\nconst Canvas = styled.canvas`\n  width: 100%;\n  height: 100%;\n  background: #e8e8e8;\n  cursor: none;\n`;\n\nconst Window = styled.div`\n  border: dashed 3px blue;\n  position: absolute;\n  background: rgba(0, 0, 255, 0.1);\n  cursor: move;\n`;\n\nconst makePicture = dataImg =>\n  new Promise((resolve, reject) => {\n    let canvasPic = new Image();\n    canvasPic.src = dataImg;\n    canvasPic.onload = function() {\n      resolve(canvasPic);\n    };\n    canvasPic.onerror = reject;\n  });\n\nconst renderLoop = (() => {\n  let canvas = null;\n  let ctx = null;\n  let dataImg = null;\n  let canUpdate = true;\n  let mode = 'mode_draw';\n  let mouseX = -100;\n  let mouseY = -100;\n  let color = '#000';\n  let size = 10;\n  let updateKey = null;\n\n  function resizeCanvas() {\n    const { width, height } = canvas.getBoundingClientRect();\n    canvas.width = width;\n    canvas.height = height;\n  }\n\n  function drawCursor() {\n    if (mode === 'mode_draw') {\n      ctx.beginPath();\n      ctx.strokeStyle = color;\n      ctx.lineWidth = size;\n      ctx.lineJoin = 'round';\n      ctx.lineCap = 'round';\n      ctx.moveTo(mouseX, mouseY);\n      ctx.lineTo(mouseX, mouseY);\n      ctx.stroke();\n      return;\n    }\n\n    if (mode === 'mode_eraser') {\n      ctx.beginPath();\n      ctx.arc(mouseX, mouseY, size / 2, 0, Math.PI * 2);\n      ctx.fillStyle = 'whitesmoke';\n      ctx.fill();\n      ctx.closePath();\n      return;\n    }\n  }\n\n  function update() {\n    if (!canUpdate) {\n      cancelAnimationFrame(updateKey);\n      updateKey = requestAnimationFrame(update);\n      return;\n    }\n    // console.log('u');\n    if (dataImg) {\n      let canvasPic = new Image();\n      canvasPic.src = dataImg;\n      canvasPic.onload = function() {\n        resizeCanvas();\n        ctx.drawImage(canvasPic, 0, 0);\n        drawCursor();\n        cancelAnimationFrame(updateKey);\n        updateKey = requestAnimationFrame(update);\n      };\n    } else {\n      resizeCanvas();\n      ctx.fillStyle = backgroundColor;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      drawCursor();\n      cancelAnimationFrame(updateKey);\n      updateKey = requestAnimationFrame(update);\n    }\n  }\n\n  return {\n    init(newCanvas) {\n      canvas = newCanvas;\n      ctx = canvas.getContext('2d');\n      update();\n    },\n    setCursor(x, y) {\n      mouseX = x;\n      mouseY = y;\n    },\n    setSpec(spec) {\n      color = spec.color;\n      size = spec.size;\n      mode = spec.mode;\n    },\n    setDataImg(newDataImg) {\n      dataImg = newDataImg;\n    },\n    getDataImg() {\n      return dataImg;\n    },\n    stopUpdate() {\n      canUpdate = false;\n    },\n    startUpdate() {\n      canUpdate = true;\n    }\n  };\n})();\n\nfunction drawLineStart({ canvas, x, y, color = '#000', size = 10 }) {\n  const ctx = canvas.getContext('2d');\n  ctx.beginPath();\n  ctx.strokeStyle = color;\n  ctx.lineWidth = size;\n  ctx.lineJoin = 'round';\n  ctx.lineCap = 'round';\n  ctx.moveTo(x, y);\n  ctx.lineTo(x, y);\n  ctx.stroke();\n}\n\nfunction drawLine({ canvas, x, y, color, size }) {\n  const ctx = canvas.getContext('2d');\n  ctx.strokeStyle = color;\n  ctx.lineWidth = size;\n  ctx.lineJoin = 'round';\n  ctx.lineCap = 'round';\n  ctx.lineTo(x, y);\n  ctx.stroke();\n}\n\nfunction clearCanvas({ canvas }) {\n  const ctx = canvas.getContext('2d');\n  // ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.fillStyle = backgroundColor;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n}\n\nconst checkSize = (() => {\n  let oldSize = null;\n  return newSize => {\n    if (null === oldSize) {\n      oldSize = newSize;\n      return oldSize;\n    }\n    const tmpSize = parseInt(newSize, 10);\n    if (isNaN(tmpSize)) {\n      return oldSize;\n    }\n    if (tmpSize < 1) {\n      oldSize = 1;\n    } else {\n      oldSize = tmpSize;\n    }\n    return oldSize;\n  };\n})();\n\nconst updateMovingWindow = (() => {\n  const memoryCanvas = document.createElement('canvas');\n  const copyCanvas = document.createElement('canvas');\n  const memoryCtx = memoryCanvas.getContext('2d');\n  const copyCtx = copyCanvas.getContext('2d');\n  let isMakingNewSecence = false;\n  let buffer = null;\n\n  function _checkBuffer() {\n    isMakingNewSecence = false;\n    if (buffer) {\n      let tmp = buffer;\n      buffer = null;\n      _update(...tmp);\n    }\n  }\n\n  async function _update({ dataImg, oldWin, newWin, canvas }) {\n    isMakingNewSecence = true;\n    if (!dataImg) {\n      return _checkBuffer();\n    }\n    const dataPic = await makePicture(dataImg);\n    memoryCanvas.width = canvas.width;\n    memoryCanvas.height = canvas.height;\n    memoryCtx.drawImage(dataPic, 0, 0);\n    // copy\n    const copyImgData = memoryCtx.getImageData(\n      oldWin.x,\n      oldWin.y,\n      oldWin.w,\n      oldWin.h\n    );\n    copyCanvas.width = oldWin.w;\n    copyCanvas.height = oldWin.h;\n    copyCtx.putImageData(copyImgData, 0, 0);\n    const copyPic = await makePicture(copyCanvas.toDataURL());\n    // clear\n    memoryCtx.clearRect(oldWin.x, oldWin.y, oldWin.w, oldWin.h);\n    // paste\n    memoryCtx.drawImage(\n      copyPic,\n      0,\n      0,\n      oldWin.w,\n      oldWin.h,\n      newWin.x,\n      newWin.y,\n      newWin.w,\n      newWin.h\n    );\n    // set\n    renderLoop.setDataImg(memoryCanvas.toDataURL());\n    // check\n    return _checkBuffer();\n  }\n\n  return (...args) => {\n    if (isMakingNewSecence) {\n      if (buffer) {\n        console.log('neglect');\n      }\n      buffer = args;\n    } else {\n      _update(...args);\n    }\n  };\n})();\n\nlet oriX = 0;\nlet oriY = 0;\n\nexport default () => {\n  const canvasRef = useRef(null);\n  const downloadTagRef = useRef(null);\n  const [drawing, setDrawing] = useState(false);\n  const [size, setSize] = useState(20);\n  const [color, setColor] = useState('#000000');\n  const [history, setHistory] = useState([]);\n  const [historyIdx, setHistoryIdx] = useState(-1);\n  const [mode, setMode] = useState('mode_draw');\n\n  const [oldWin, setOldWin] = useState(null);\n  const [win, setWin] = useState({ x: 0, y: 0, h: 0, w: 0 });\n  const [showWin, setShowWin] = useState(false);\n  const [isCreateWindow, setIsCreateWindow] = useState(false);\n  const [isAdjusteWindow, setIsAdjusteWindow] = useState(false);\n\n  // console.log({ history, historyIdx });\n\n  // compute update\n  const canRedo = history.length > historyIdx + 1;\n  const canUndo = historyIdx > -1;\n  const canvasStyle = {\n    cursor: mode === 'mode_window' ? 'crosshair' : 'none'\n  };\n  const windowStyle = {\n    left: win.x,\n    top: win.y,\n    width: win.w,\n    height: win.h,\n    display: showWin ? 'block' : 'none'\n  };\n\n  // Init RenderLoop\n  useEffect(() => {\n    renderLoop.setSpec({ size, color, mode });\n    renderLoop.init(canvasRef.current);\n  }, []);\n\n  // Update RenderLoop Spec\n  useEffect(() => {\n    renderLoop.setSpec({ size, color, mode });\n  }, [size, color, mode]);\n\n  // Watch mode\n  useEffect(() => {\n    setShowWin(false);\n  }, [mode]);\n\n  // Watch isCreateWindow\n  useEffect(() => {\n    function onWindowMouseMove(e) {\n      if (isCreateWindow) {\n        let x = Math.min(win.x, e.clientX);\n        let y = Math.min(win.y, e.clientY);\n        let w = Math.abs(win.x - e.clientX);\n        let h = Math.abs(win.y - e.clientY);\n        setWin({ x, y, w, h });\n        setShowWin(true);\n      }\n    }\n    function onWindowMouseUp() {\n      if (isCreateWindow) {\n        setIsCreateWindow(false);\n      }\n    }\n    window.addEventListener('mousemove', onWindowMouseMove);\n    window.addEventListener('mouseup', onWindowMouseUp);\n    return () => {\n      window.removeEventListener('mousemove', onWindowMouseMove);\n      window.removeEventListener('mouseup', onWindowMouseUp);\n    };\n  }, [isCreateWindow]);\n\n  // Watch isAdjustWIndow\n  useEffect(() => {\n    function onWindowMouseMove(e) {\n      if (isAdjusteWindow) {\n        let x = win.x + e.clientX - oriX;\n        let y = win.y + e.clientY - oriY;\n        const newWin = { ...win, x, y };\n        setWin(newWin);\n        // makeTmpDataImg(newWin);\n        updateMovingWindow({\n          newWin,\n          oldWin,\n          canvas: canvasRef.current,\n          dataImg: history[historyIdx]\n        });\n      }\n    }\n    function onWindowMouseUp() {\n      if (isAdjusteWindow) {\n        setIsAdjusteWindow(false);\n        const dataImg = renderLoop.getDataImg();\n        if (dataImg) {\n          pushHistory(dataImg);\n        }\n      }\n    }\n    window.addEventListener('mousemove', onWindowMouseMove);\n    window.addEventListener('mouseup', onWindowMouseUp);\n    return () => {\n      window.removeEventListener('mousemove', onWindowMouseMove);\n      window.removeEventListener('mouseup', onWindowMouseUp);\n    };\n  }, [isAdjusteWindow]);\n\n  function pushHistory(newDataImg) {\n    let oldHistory = history.slice(0, historyIdx + 1);\n    setHistory([...oldHistory, newDataImg]);\n    setHistoryIdx(historyIdx + 1);\n  }\n\n  function onWinMouseDown(e) {\n    oriX = e.clientX;\n    oriY = e.clientY;\n    setOldWin({ ...win });\n    setIsAdjusteWindow(true);\n  }\n\n  function onCanvasMouseDown(e) {\n    if (mode === 'mode_window') {\n      setIsCreateWindow(true);\n      setWin({ x: e.clientX, y: e.clientY, w: 3, h: 3 });\n      setShowWin(false);\n      return;\n    }\n\n    setDrawing(true);\n    renderLoop.stopUpdate();\n\n    const correctSize = checkSize(size);\n    setSize(correctSize);\n    const newColor = mode === 'mode_draw' ? color : backgroundColor;\n    drawLineStart({\n      canvas: canvasRef.current,\n      x: e.clientX,\n      y: e.clientY,\n      color: newColor,\n      size: correctSize\n    });\n  }\n\n  function onCanvasMouseMove(e) {\n    if (mode === 'mode_window') {\n      return false;\n    }\n\n    const x = e.clientX;\n    const y = e.clientY;\n    if (drawing) {\n      const correctSize = checkSize(size);\n      if (size !== correctSize) {\n        setSize(correctSize);\n      }\n      const newColor = mode === 'mode_draw' ? color : backgroundColor;\n      drawLine({\n        canvas: canvasRef.current,\n        x,\n        y,\n        color: newColor,\n        size: correctSize\n      });\n    } else {\n      renderLoop.setCursor(x, y);\n    }\n  }\n\n  function onCanvasMouseUp() {\n    if (mode === 'mode_window') {\n      return false;\n    }\n\n    let newDataImg = canvasRef.current.toDataURL();\n    pushHistory(newDataImg);\n    renderLoop.setDataImg(newDataImg);\n    renderLoop.startUpdate();\n    setDrawing(false);\n  }\n\n  function onCanvasMouseLeave() {\n    renderLoop.setCursor(-100, -100);\n  }\n\n  function onClickClearBtn() {\n    clearCanvas({ canvas: canvasRef.current });\n    let newDataImg = canvasRef.current.toDataURL();\n    pushHistory(newDataImg);\n    renderLoop.setDataImg(newDataImg);\n    setShowWin(false);\n  }\n\n  function onCheckSize() {\n    const correctSize = checkSize(size);\n    setSize(correctSize);\n  }\n\n  function onClickUndoBtn() {\n    if (canUndo) {\n      if (historyIdx === 0) {\n        clearCanvas({ canvas: canvasRef.current });\n        let newDataImg = canvasRef.current.toDataURL();\n        renderLoop.setDataImg(newDataImg);\n      } else {\n        const dataImg = history[historyIdx - 1];\n        renderLoop.setDataImg(dataImg);\n      }\n      setHistoryIdx(historyIdx - 1);\n      setShowWin(false);\n    }\n  }\n\n  function onClickRedoBtn() {\n    if (canRedo) {\n      const dataImg = history[historyIdx + 1];\n      renderLoop.setDataImg(dataImg);\n      setHistoryIdx(historyIdx + 1);\n    }\n  }\n\n  function onClickSaveBtn() {\n    const dataURL = canvasRef.current.toDataURL('image/png');\n    const aTag = downloadTagRef.current;\n    aTag.href = dataURL;\n    aTag.download = 'canvas-' + new Date().toISOString() + '.png';\n    aTag.click();\n  }\n\n  return (\n    <>\n      <Window style={windowStyle} onMouseDown={onWinMouseDown} />\n      <Canvas\n        ref={canvasRef}\n        style={canvasStyle}\n        onMouseDown={onCanvasMouseDown}\n        onMouseMove={onCanvasMouseMove}\n        onMouseUp={onCanvasMouseUp}\n        onMouseLeave={onCanvasMouseLeave}\n      />\n      <TopPanel\n        onClickClearBtn={onClickClearBtn}\n        onClickUndoBtn={onClickUndoBtn}\n        onClickRedoBtn={onClickRedoBtn}\n        onClickSaveBtn={onClickSaveBtn}\n        canRedo={canRedo}\n        canUndo={canUndo}\n      />\n      <BottomPanel\n        size={size}\n        setSize={setSize}\n        onCheckSize={onCheckSize}\n        color={color}\n        setColor={setColor}\n        mode={mode}\n        setMode={setMode}\n      />\n      <a\n        href=\"#?file\"\n        style={{ display: 'none' }}\n        hidden={true}\n        ref={downloadTagRef}\n      >\n        Download Link\n      </a>\n    </>\n  );\n};\n","import React from 'react';\nimport { createGlobalStyle } from 'styled-components';\nimport Canvas from './components/Canvas.jsx';\n\nconst GlobalStyle = createGlobalStyle`\n  *, *::before, *::after {\n    box-sizing: border-box;\n  }\n  html, body, #root {\n    height: 100%;\n    margin: 0;\n    padding: 0;\n  }\n  body, input {\n    font-family: 'Open Sans', sans-serif;\n    font-weight: bold;\n  }\n  body {\n    overflow: hidden;\n    user-select: none;\n  }\n`;\n\nfunction App() {\n  return (\n    <>\n      <GlobalStyle />\n      <Canvas />\n    </>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App.jsx';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}